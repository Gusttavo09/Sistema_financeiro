<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Sistema Acad√™mico</title>
    <style>
       
    </style>
</head>
<body>
    <div class="container">
        <h1>üìö Sistema de Gest√£o Acad√™mica</h1>

        <div id="alert" class="alert"></div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('alunos')">Alunos</button>
            <button class="tab" onclick="showTab('disciplinas')">Disciplinas</button>
            <button class="tab" onclick="showTab('matriculas')">Matr√≠culas</button>
        </div>

        <!-- Tab Alunos -->
        <div id="alunos" class="tab-content active">
            <h2>Cadastrar Aluno</h2>
            <form id="formAluno" class="form-inline">
                <div class="form-group">
                    <label>Nome:</label>
                    <input type="text" id="nomeAluno" required>
                </div>
                <div class="form-group">
                    <label>Idade:</label>
                    <input type="text" id="idadeAluno" required>
                </div>
                <div class="form-group">
                    <label>Matr√≠cula:</label>
                    <input type="number" id="matriculaAluno" required>
                </div>
                <div class="form-group">
                    <label>Data de Cadastro:</label>
                    <input type="date" id="dataCadastroAluno" required>
                </div>
                <div class="form-group">
                    <label>Semestre:</label>
                    <input type="number" id="semestreAluno" required>
                </div>
                <button type="submit">Cadastrar Aluno</button>
            </form>

            <h2>Lista de Alunos</h2>
            <table id="tabelaAlunos">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Idade</th>
                        <th>Matr√≠cula</th>
                        <th>Semestre</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Tab Disciplinas -->
        <div id="disciplinas" class="tab-content">
            <h2>Cadastrar Disciplina</h2>
            <form id="formDisciplina" class="form-inline">
                <div class="form-group">
                    <label>Nome:</label>
                    <input type="text" id="nomeDisciplina" required>
                </div>
                <div class="form-group">
                    <label>Curso:</label>
                    <input type="text" id="cursoDisciplina" required>
                </div>
                <div class="form-group">
                    <label>C√≥digo:</label>
                    <input type="number" id="codigoDisciplina" required>
                </div>
                <button type="submit">Cadastrar Disciplina</button>
            </form>

            <h2>Lista de Disciplinas</h2>
            <table id="tabelaDisciplinas">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Curso</th>
                        <th>C√≥digo</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Tab Matr√≠culas -->
        <div id="matriculas" class="tab-content">
            <h2>Realizar Matr√≠cula</h2>
            <form id="formMatricula" class="form-inline">
                <div class="form-group">
                    <label>Aluno:</label>
                    <select id="alunoMatricula" required></select>
                </div>
                <div class="form-group">
                    <label>Disciplina:</label>
                    <select id="disciplinaMatricula" required></select>
                </div>
                <div class="form-group">
                    <label>Peso:</label>
                    <input type="number" id="pesoMatricula" value="10" required>
                </div>
                <div class="form-group">
                    <label>Nota:</label>
                    <input type="number" step="0.1" id="notaMatricula" required>
                </div>
                <div class="form-group">
                    <label>Data:</label>
                    <input type="date" id="dataMatricula" required>
                </div>
                <button type="submit">Matricular</button>
            </form>

            <h2>Lista de Matr√≠culas</h2>
            <table id="tabelaMatriculas">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Aluno</th>
                        <th>Disciplina</th>
                        <th>Nota</th>
                        <th>Peso</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000';

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'alunos') carregarAlunos();
            if (tabName === 'disciplinas') carregarDisciplinas();
            if (tabName === 'matriculas') {
                carregarMatriculas();
                carregarSelectAlunos();
                carregarSelectDisciplinas();
            }
        }

        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `alert ${type} show`;
            setTimeout(() => alert.classList.remove('show'), 3000);
        }

        // ALUNOS
        document.getElementById('formAluno').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const aluno = {
                nome: document.getElementById('nomeAluno').value,
                idade: document.getElementById('idadeAluno').value,
                matricula: document.getElementById('matriculaAluno').value,
                data_cadastro: document.getElementById('dataCadastroAluno').value,
                semestre: document.getElementById('semestreAluno').value
            };

            try {
                const response = await fetch(`${API_URL}/alunos`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(aluno)
                });

                if (response.ok) {
                    showAlert('Aluno cadastrado com sucesso!', 'success');
                    e.target.reset();
                    carregarAlunos();
                } else {
                    showAlert('Erro ao cadastrar aluno', 'error');
                }
            } catch (error) {
                showAlert('Erro de conex√£o com o servidor', 'error');
            }
        });

        async function carregarAlunos() {
            try {
                const response = await fetch(`${API_URL}/alunos`);
                const alunos = await response.json();
                
                const tbody = document.querySelector('#tabelaAlunos tbody');
                tbody.innerHTML = alunos.map(a => `
                    <tr>
                        <td>${a.id}</td>
                        <td>${a.nome}</td>
                        <td>${a.idade}</td>
                        <td>${a.matricula}</td>
                        <td>${a.semestre}</td>
                        <td class="actions">
                            <button class="btn-small btn-danger" onclick="deletarAluno(${a.id})">Excluir</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Erro ao carregar alunos:', error);
            }
        }

        async function deletarAluno(id) {
            if (!confirm('Deseja realmente excluir este aluno?')) return;
            
            try {
                const response = await fetch(`${API_URL}/alunos/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showAlert('Aluno exclu√≠do com sucesso!', 'success');
                    carregarAlunos();
                }
            } catch (error) {
                showAlert('Erro ao excluir aluno', 'error');
            }
        }

        // DISCIPLINAS
        document.getElementById('formDisciplina').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const disciplina = {
                nome: document.getElementById('nomeDisciplina').value,
                curso: document.getElementById('cursoDisciplina').value,
                codigo: document.getElementById('codigoDisciplina').value
            };

            try {
                const response = await fetch(`${API_URL}/disciplinas`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(disciplina)
                });

                if (response.ok) {
                    showAlert('Disciplina cadastrada com sucesso!', 'success');
                    e.target.reset();
                    carregarDisciplinas();
                }
            } catch (error) {
                showAlert('Erro ao cadastrar disciplina', 'error');
            }
        });

        async function carregarDisciplinas() {
            try {
                const response = await fetch(`${API_URL}/disciplinas`);
                const disciplinas = await response.json();
                
                const tbody = document.querySelector('#tabelaDisciplinas tbody');
                tbody.innerHTML = disciplinas.map(d => `
                    <tr>
                        <td>${d.id}</td>
                        <td>${d.nome}</td>
                        <td>${d.curso}</td>
                        <td>${d.codigo}</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Erro ao carregar disciplinas:', error);
            }
        }

        // MATR√çCULAS
        async function carregarSelectAlunos() {
            try {
                const response = await fetch(`${API_URL}/alunos`);
                const alunos = await response.json();
                
                const select = document.getElementById('alunoMatricula');
                select.innerHTML = '<option value="">Selecione um aluno</option>' +
                    alunos.map(a => `<option value="${a.id}">${a.nome}</option>`).join('');
            } catch (error) {
                console.error('Erro ao carregar alunos:', error);
            }
        }

        async function carregarSelectDisciplinas() {
            try {
                const response = await fetch(`${API_URL}/disciplinas`);
                const disciplinas = await response.json();
                
                const select = document.getElementById('disciplinaMatricula');
                select.innerHTML = '<option value="">Selecione uma disciplina</option>' +
                    disciplinas.map(d => `<option value="${d.id}">${d.nome}</option>`).join('');
            } catch (error) {
                console.error('Erro ao carregar disciplinas:', error);
            }
        }

        document.getElementById('formMatricula').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const matricula = {
                aluno_id: document.getElementById('alunoMatricula').value,
                disciplina_id: document.getElementById('disciplinaMatricula').value,
                peso: document.getElementById('pesoMatricula').value,
                nota: document.getElementById('notaMatricula').value,
                data_cadastro: document.getElementById('dataMatricula').value
            };

            try {
                const response = await fetch(`${API_URL}/matriculas`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(matricula)
                });

                if (response.ok) {
                    showAlert('Matr√≠cula realizada com sucesso!', 'success');
                    e.target.reset();
                    carregarMatriculas();
                }
            } catch (error) {
                showAlert('Erro ao realizar matr√≠cula', 'error');
            }
        });

        async function carregarMatriculas() {
            try {
                const response = await fetch(`${API_URL}/matriculas`);
                const matriculas = await response.json();
                
                const tbody = document.querySelector('#tabelaMatriculas tbody');
                tbody.innerHTML = matriculas.map(m => `
                    <tr>
                        <td>${m.id}</td>
                        <td>${m.nome_aluno}</td>
                        <td>${m.nome_disciplina}</td>
                        <td>${m.nota}</td>
                        <td>${m.peso}</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Erro ao carregar matr√≠culas:', error);
            }
        }

        // Carregar dados iniciais
        carregarAlunos();
    </script>
</body>
</html>